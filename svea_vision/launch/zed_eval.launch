<?xml version="1.0"?>
<launch>

    <arg name="mocap_name"          default="rsu"/>

    <!-- Options -->
    <arg name="use_cuda"            default="true"/>
    <arg name="enable_bbox_image"   default="false"/>
    <arg name="enable_aruco"        default="false"/>
    <arg name="frame_id"            default="mocap"/>

    <!-- Auxiliary -->
    <arg name="only_objects"        default=""/>
    <arg name="skip_objects"        default=""/>
    <arg name="max_age"             default="30"/>
    <arg name="aruco_size"          default="0.1"/>

    <!-- Constants -->
    <arg name="depth_image"     value="/zed/zed_node/depth/depth_registered"/>
    <arg name="image"           value="/zed/zed_node/rgb/image_rect_color"/>

    <!-- Nodes -->
    <include file="$(find zed_wrapper)/launch/zed.launch">
        <arg name="camera_name" value="zed"/>
    </include>

    <include file="$(find svea_vision)/launch/object_pose.launch">
        <!-- Options -->
        <arg name="use_cuda"            value="$(arg use_cuda)"/>
        <arg name="enable_bbox_image"   value="$(arg enable_bbox_image)"/>
        <arg name="frame_id"            value="$(arg frame_id)"/>
        <!-- Consumed topics -->
        <arg name="image"               value="$(arg image)"/>
        <arg name="depth_image"         value="$(arg depth_image)"/>
        <!-- Auxiliary -->
        <arg name="only_objects"        value="$(arg only_objects)"/>
        <arg name="skip_objects"        value="$(arg skip_objects)"/>
        <arg name="max_age"             value="$(arg max_age)"/>
    </include>
    
    <!-- Motion Capture System -->
    <group>
        <arg name="mocap_address" value="10.0.0.10"/>

        <include file="$(find mocap_qualisys)/launch/qualisys.launch">
            <arg name="server_address" value="$(arg mocap_address)"/>
        </include>

        <!-- Static Transforms-->
        <include file="$(find svea_sensors)/launch/transforms.launch"/>
        <node pkg="tf" type="static_transform_publisher" name="sensor_broadcaster" output="screen" args="0 0 0 0 0 0 $(arg mocap_name) zed_base_link 100"/>
    </group>

    <!-- Record rosbag -->
    <node pkg="rosbag" type="record" name="rosbag_record"
          args="record -o $(find svea_vision)/out /objectposes /qualisys/pedestrian/pose /qualisys/pedestrian/velocity"/>

</launch>
